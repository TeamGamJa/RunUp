<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="running">
   
   <select id="getCategoryBigList" resultType="String">
    <![CDATA[
      select distinct categoryBig from category
    ]]>  
   </select>
   
   <select id="getCategoryMediumList" resultType="String">
    <![CDATA[
      select distinct categoryMedium from category
    ]]>  
   </select>
   
   <select id="getCategoryMediumListByCategoryBig" resultType="String">
    <![CDATA[
      select distinct categoryMedium from category where categoryBig = #{categoryBig}
    ]]>  
   </select>
   
   <select id="getRunningList" resultType="Runup">
   <![CDATA[
   	  select runningNum, runningTitle, userNickname, runningCategoryMedium, userLuxColor,
   	  userMentorCnt, DATE_FORMAT(runningDate,'%Y-%m-%d') AS runningDate, runningAble
   	  from running where runningShow = 1
   ]]>
   </select>
   
   <select id="getRunningBycategorybig" parameterType = "String" resultType="Runup">
   <![CDATA[
   	  select runningNum, runningTitle, userNickname, runningCategoryMedium, userLuxColor,
   	  userMentorCnt, DATE_FORMAT(runningDate,'%Y-%m-%d') AS runningDate, runningAble
   	  from running where runningShow = 1 and runningCategoryBig = #{runningCategoryBig}
   ]]>
   </select>
   
   <select id="getRunningBycategorymedium" parameterType = "String" resultType="Runup">
   <![CDATA[
   	  select runningNum, runningTitle, userNickname, runningCategoryMedium, userLuxColor,
   	  userMentorCnt, DATE_FORMAT(runningDate,'%Y-%m-%d') AS runningDate, runningAble
   	  from running where runningShow = 1 and runningCategoryMedium = #{runningCategoryMedium}
   ]]>
   </select>
   
   <select id="getRunningByKeyword" parameterType="String" resultType="Running">
   <![CDATA[
      select *
      from running where runningShow = 1 and runningTitle Like CONCAT('%', #{keyword},'%')
   ]]>
   </select>
   
   <select id="getRunning" parameterType="Running" resultType="Running">
   <![CDATA[
   	  select * 
   	  from running where runningNum = #{runningNum}
   ]]>
   </select>
   
   <select id="getUserNumByRunningNum" parameterType="int" resultType="int">
   <![CDATA[
   	  select userNum
   	  from running where runningNum = #{runningNum}
   ]]>
   </select>
   
   <select id="getRunningByRunningAble" parameterType="int" resultType="RunCalender">
   <![CDATA[
   	  select runningTitle, runningCategoryMedium, userNickname, runningStartSmall, runningEndSmall, runningContent
   	  from running where userNum = #{userNum} and runningAble = false and runningShow = True
   ]]>
   </select>
   
   <select id="getRunningByRunningAbleTrue" parameterType="int" resultType="RunCalender">
   <![CDATA[
   	  select runningTitle, runningCategoryMedium, userNickname, runningStartSmall, runningEndSmall, runningContent
   	  from running where userNum = #{userNum} and runningAble = True and runningShow = True
   ]]>
   </select>
   
   <select id="getRunningByRunningShow" parameterType="int" resultType="RunCalender">
   <![CDATA[
   	  select runningTitle, runningCategoryMedium, userNickname, runningStartSmall, runningEndSmall, runningContent
   	  from running where userNum = #{userNum} and runningShow = False
   ]]>
   </select>
   
   <select id="countMentor" parameterType="int" resultType="int">
   <![CDATA[
   	  select count(*) 
   	  from running where runningShow = false and userNum = #{userNum}
   ]]>
   </select>
   
   <insert id="createRunning" parameterType="Running">
   <![CDATA[
     insert into running(runningTitle,runningContent,runningCategoryBig,
     runningCategoryMedium, runningStartBig, runningStartSmall, runningEndBig, runningEndSmall,runningKeep,userNum,userNickname,runningDate,runningColor,userMentorCnt) 
     values (#{runningTitle}, #{runningContent}, #{runningCategoryBig}, #{runningCategoryMedium}, #{runningStartBig}, 
     #{runningStartSmall}, #{runningEndBig}, #{runningEndSmall}, #{runningKeep}, #{userNum},#{userNickname}, #{runningDate},#{runningColor},#{userMentorCnt})
   ]]>
   </insert>
   
   <insert id="createRegister" parameterType="Running">
   <![CDATA[
     insert into register(userNum, runningNum) 
     values (#{userNum},#{runningNum})
   ]]>
   </insert>
   
   <delete id="deleteRegister" parameterType="Running">
   <![CDATA[
     delete from register where userNum = #{userNum} and runningNum = #{runningNum}
   ]]>
   </delete>
   
   <delete id="deleteRunning" parameterType="Running">
   <![CDATA[
     delete from running where userNum = #{userNum} and runningNum = #{runningNum}
   ]]>
   </delete>
   
   <update id="updateRunning" parameterType="Running" >
   <![CDATA[
     update running set runningTitle = #{runningTitle}, runningContent = #{runningContent}, 
     runningCategoryBig = #{runningCategoryBig}, runningCategoryMedium = #{runningCategoryMedium},
     runningStartBig = #{runningStartBig}, runningStartSmall = #{runningStartSmall}, 
     runningEndBig = #{runningEndBig}, runningEndSmall = #{runningEndSmall},
     runningKeep = #{runningKeep}
     where userNum = #{userNum} and runningNum = #{runningNum}
   ]]>
   </update>
   
   <update id="updateRunningAble" parameterType="Running">
   <![CDATA[
   	 update running set runningAble =
   	 case
   	 	when runningAble = true then false
   	 	else true
   	 end	
   	 where runningNum = #{runningNum}
   ]]>
   </update>
   
   <update id="updateViewNum" parameterType="Running" >
   <![CDATA[
   	 update running set runningViewNum = runningViewNum + 1 
   	 where runningNum = #{runningNum}
   ]]>
   </update>
   
</mapper>